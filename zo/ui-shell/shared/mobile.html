<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zo-Qore Mobile</title>
    <!-- Fallback to system fonts if CSP blocks Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;800&family=Inter:wght@400;500;600&display=swap');
    </style>
    <link rel="stylesheet" href="mobile.css">
    <!-- Web App Manifest / Fullscreen Meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Zo-Qore">
    <meta name="apple-mobile-web-app-title" content="Zo-Qore">
    <meta name="theme-color" content="#0f1219">
    
    <!-- Rotation Lock -->
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="orientation" content="portrait">
    <script>
        // Attempt to lock orientation to portrait
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('portrait').catch(function(error) {
                // Silently fail if not supported or not in fullscreen
                console.log('Orientation lock not supported or failed:', error);
            });
        }
    </script>
</head>
<body>
    <div class="app-container">
        
        <!-- Global Header -->
        <header class="app-header">
            <div class="header-left">
                <img src="/favicon.png" alt="Logo" class="app-logo" id="app-logo-btn">
                <span class="app-name">Zo-Qore Mobile</span>
            </div>
            <div class="header-right">
                <span id="header-tab-name" class="header-tab-name">Projects</span>
            </div>
        </header>

        <main class="content-area">
            
            <!-- TAB 1: PROJECTS (Strategy) -->
            <section id="tab-strategy" class="tab-content active">
                
                <div class="glass-card dropdown-trigger" id="repo-selector-btn">
                    <span class="dropdown-label">Repository</span>
                    <div class="dropdown-value">
                        <span class="repo-name" id="current-repo-name">FailSafe-Qore</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </div>
                </div>

                <!-- Overall Project Status Bar -->
                <div class="glass-card status-overview-card">
                    <div class="status-header">
                        <span class="section-label">Overall Project Status</span>
                        <span class="status-percent">65%</span>
                    </div>
                    <div class="project-progress-track">
                        <div class="project-progress-fill" style="width: 65%;"></div>
                    </div>
                    <div class="status-footer">
                        <span class="status-stage">Phase: <span class="highlight">Implementation</span></span>
                        <span class="status-health">Health: <span class="good">Stable</span></span>
                    </div>
                </div>

                <!-- Milestone Queue -->
                <div class="glass-card">
                    <div class="card-header-row">
                        <span class="section-label" style="margin-bottom:0;">Milestone Queue</span>
                        <button class="settings-gear-btn slim" id="queue-settings-btn">
                             <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                        </button>
                    </div>
                    <div class="milestone-list" id="milestone-list">
                        <!-- Active Item with Progress Dial -->
                        <div class="milestone-item active with-chart">
                            <div class="milestone-left">
                                <div class="milestone-icon">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                                </div>
                                <div class="milestone-info">
                                    <div class="milestone-title highlight">Refine UI</div>
                                    <div class="milestone-feature">Target: Mobile Dashboard</div>
                                </div>
                            </div>
                            <!-- Circular Progress Chart moved here -->
                            <div class="milestone-chart">
                                <svg viewBox="0 0 36 36" class="circular-chart blue">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle" stroke-dasharray="78, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                </svg>
                                <span class="chart-text">78%</span>
                            </div>
                        </div>

                        <!-- Queue Items (Visibility controlled by JS) -->
                        <div class="milestone-item queued queue-item">
                            <div class="milestone-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                            </div>
                            <div class="milestone-info">
                                <div class="milestone-title warn">Auth Flow</div>
                                <div class="milestone-feature">Target: MFA Integration</div>
                            </div>
                        </div>

                        <div class="milestone-item future queue-item" style="opacity:0.6;">
                            <div class="milestone-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            </div>
                            <div class="milestone-info">
                                <div class="milestone-title">Audit</div>
                                <div class="milestone-feature">Target: Security Review</div>
                            </div>
                        </div>

                        <div class="milestone-item future queue-item" style="opacity:0.6;">
                            <div class="milestone-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 6l-9.5 9.5-5-5L1 18"></path><path d="M17 6h6v6"></path></svg>
                            </div>
                            <div class="milestone-info">
                                <div class="milestone-title">Optimization</div>
                                <div class="milestone-feature">Target: Asset Bundling</div>
                            </div>
                        </div>

                         <div class="milestone-item future queue-item" style="opacity:0.6;">
                            <div class="milestone-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 17l6-6 4 4 8-8"></path><path d="M14 7h7v7"></path></svg>
                            </div>
                            <div class="milestone-info">
                                <div class="milestone-title">Analytics</div>
                                <div class="milestone-feature">Target: User Metrics</div>
                            </div>
                        </div>

                         <div class="milestone-item future queue-item" style="opacity:0.6;">
                            <div class="milestone-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                            </div>
                            <div class="milestone-info">
                                <div class="milestone-title">Dark Mode V2</div>
                                <div class="milestone-feature">Target: High Contrast</div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <!-- TAB 2: CONSOLE (Engine) -->
            <section id="tab-console" class="tab-content" style="display:none;">
                
                <!-- Deployment Stage Viz -->
                <div class="glass-card">
                    <div class="deployment-card-header">
                        <span class="section-label" style="margin-bottom:0;">Deployment Stage</span>
                        <div class="debug-light">
                            <span>Debug Status</span>
                            <div class="led"></div> 
                        </div>
                    </div>
                    
                    <div class="deployment-stages">
                        <div class="stage-step done" data-label="Plan">
                            <div class="stage-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></div>
                        </div>
                        <div class="stage-step done" data-label="Audit">
                            <div class="stage-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div>
                        </div>
                        <div class="stage-step active" data-label="Implement">
                            <div class="stage-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></svg></div>
                        </div>
                        <div class="stage-step" data-label="Substantiate">
                            <div class="stage-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></div>
                        </div>
                    </div>

                    <div class="active-stage-display">
                        <span class="active-stage-label">Implement</span>
                        <div class="active-stage-indicator">
                            <span class="pulse-dot"></span>
                            <span class="active-stage-sub">Building Core Features</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <span class="section-label">Command Stream</span>
                    <div class="console-output">
                        <div class="log-entry"><span class="log-ts">[10:45:32]</span> <span class="log-sys">System:</span> Environment discovered. AWS region us-east-1 selected.</div>
                        <div class="log-entry"><span class="log-ts">[10:45:35]</span> <span class="log-sys">System:</span> Compiling assets for production build...</div>
                        <div class="log-entry" style="text-align: center; margin: 20px 0;"><span style="display:inline-block; border-top: 2px dashed #333; width: 40px; transform:rotate(45deg);"></span></div>
                        <div class="log-entry" style="background: rgba(0,255,100,0.1); padding: 8px; border-left: 3px solid #00ff64; border-radius: 4px;">
                            <span class="log-ts">[10:45:40]</span> <span class="log-agent">Agent Qore-7:</span> Verified dependencies. Proceeding with secure containerization.
                        </div>
                    </div>
                    
                    <div class="command-input-area">
                        <button class="skill-btn" id="skill-selector-btn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                        </button>
                        <input type="text" class="cmd-input" id="cmd-input" placeholder="Enter command..." />
                        <button class="cmd-btn" id="send-cmd-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- TAB 3: MONITOR (Health) -->
            <section id="tab-monitor" class="tab-content" style="display:none;">
                
                <!-- Sentinel Status Card -->
                <div class="glass-card sentinel-card">
                    <span class="section-label">Sentinel Status</span>
                    <div class="sentinel-body">
                        <div class="sentinel-orb-container">
                             <div class="sentinel-orb warning"></div>
                        </div>
                        <div class="sentinel-info">
                            <span class="sentinel-state warning">Warnings</span>
                        </div>
                        <div class="sentinel-queue">
                            <span class="queue-label">QUEUE</span>
                            <span class="queue-count">0</span>
                        </div>
                    </div>
                        <div class="sentinel-alert">
                        <span style="flex:1;">Runtime unreachable. Check API key.</span>
                    </div>
                </div>

                <!-- Workspace Health Grid -->
                <div class="glass-card">
                    <span class="section-label">Workspace Health</span>
                    <div class="health-grid">
                        <!-- 1. Critical Blockers -->
                        <div class="health-item">
                            <span class="health-label">Critical Blockers</span>
                            <span class="health-value">0</span>
                            <div class="health-bar-track">
                                <div class="health-bar-fill gradient-rainbow" style="width: 0%;"></div>
                            </div>
                        </div>

                        <!-- 2. Unverified Changes -->
                        <div class="health-item">
                            <span class="health-label">Unverified Changes</span>
                            <div class="tank-container">
                                <div class="tank-fill" style="height: 17%;"></div>
                            </div>
                            <span class="health-sub">17% Full</span>
                        </div>

                        <!-- 3. Error Budget Burn -->
                        <div class="health-item">
                            <span class="health-label">Error Budget Burn</span>
                            <div class="arc-chart-container">
                                <svg viewBox="0 0 100 50" class="arc-svg">
                                    <path d="M10,50 A40,40 0 0,1 90,50" class="arc-bg" />
                                    <path d="M10,50 A40,40 0 0,1 18,36" class="arc-fill" /> <!-- Approx 4% visual -->
                                </svg>
                                <span class="health-value-overlay">4%</span>
                            </div>
                        </div>

                        <!-- 4. Policy Trend -->
                        <div class="health-item">
                            <span class="health-label">Policy Trend</span>
                            <div class="slider-track">
                                <div class="slider-thumb" style="left: 45%;"></div>
                                <div class="slider-fill" style="width: 45%;"></div>
                            </div>
                            <span class="health-value-large">45%</span>
                        </div>
                    </div>
                </div>

                <!-- Footer Status Bar -->
                <div class="monitor-footer">
                    <div class="footer-stats-row">
                        <div class="footer-stat">QORE: <span class="bad">UNREACHABLE</span></div>
                        <div class="footer-stat">POLICY: <span class="muted">UNKNOWN</span></div>
                    </div>
                    <div class="footer-stats-row">
                         <div class="footer-stat">LATENCY: <span class="muted">N/A</span></div>
                         <button class="footer-refresh">REFRESH</button>
                    </div>
                </div>

            </section>

        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-target="tab-strategy" data-label="Projects">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
                        <line x1="8" y1="2" x2="8" y2="18"></line>
                        <line x1="16" y1="6" x2="16" y2="22"></line>
                    </svg>
                </span>
                <span class="label">Projects</span>
            </button>
            <button class="nav-item" data-target="tab-console" data-label="Console">
                <span class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="4 17 10 11 4 5"></polyline>
                        <line x1="12" y1="19" x2="20" y2="19"></line>
                    </svg>
                </span>
                <span class="label">Console</span>
            </button>
            <button class="nav-item" data-target="tab-monitor" data-label="Monitor">
                <span class="icon">
                     <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                    </svg>
                </span>
                <span class="label">Monitor</span>
            </button>
        </nav>
        
        <!-- Theme Settings Modal -->
        <div id="settings-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content glass-card">
                <h2 class="modal-title">Settings</h2>
                
                <div class="setting-group">
                    <span class="section-label">Select Theme</span>
                    <div class="theme-options-grid">
                        <button class="theme-card" data-theme="pegasus">
                            <div class="theme-swatch">
                                <span style="background:#f1f5f9;"></span><span style="background:#3b82f6;"></span>
                            </div>
                            <span class="theme-name">Pegasus</span>
                        </button>
                        <button class="theme-card active" data-theme="mythiq">
                            <div class="theme-swatch">
                                <span style="background:#0f1219;"></span><span style="background:#6366f1;"></span>
                            </div>
                            <span class="theme-name">Mythiq</span>
                        </button>
                        <button class="theme-card" data-theme="midnight">
                            <div class="theme-swatch">
                                <span style="background:#000000;"></span><span style="background:#475569;"></span>
                            </div>
                            <span class="theme-name">Midnight</span>
                        </button>
                        <button class="theme-card" data-theme="aurora">
                            <div class="theme-swatch">
                                <span style="background:#022c22;"></span><span style="background:#2dd4bf;"></span>
                            </div>
                            <span class="theme-name">Aurora</span>
                        </button>
                         <button class="theme-card" data-theme="crimson">
                            <div class="theme-swatch">
                                <span style="background:#2a0a0a;"></span><span style="background:#ef4444;"></span>
                            </div>
                            <span class="theme-name">Crimson</span>
                        </button>
                         <button class="theme-card" data-theme="atmosphere">
                            <div class="theme-swatch">
                                <span style="background:linear-gradient(135deg, #0f172a, #334155);"></span><span style="background:linear-gradient(45deg, #38bdf8, #facc15);"></span>
                            </div>
                            <span class="theme-name">Atmosphere</span>
                        </button>
                    </div>
                </div>

                <div class="setting-group">
                    <button id="fullscreen-btn" class="zo-link-btn" style="justify-content: center; gap: 8px;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
                        <span>Toggle Fullscreen</span>
                    </button>
                    <div style="height:12px;"></div>
                    <a href="https://zo.computer" target="_blank" class="zo-link-btn">
                        <span>Visit Zo.computer</span>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                    </a>
                </div>

                <button id="close-modal-btn" class="close-btn">Close</button>
            </div>
        </div>

        <!-- Queue Settings Modal (Specific) -->
        <div id="queue-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content glass-card" style="max-width: 300px;">
                <h2 class="modal-title">Queue Options</h2>
                <div class="setting-group">
                    <span class="section-label">Visible Milestones</span>
                    <div class="queue-options">
                        <button class="queue-btn" data-value="2">2</button>
                        <button class="queue-btn active" data-value="3">3</button>
                        <button class="queue-btn" data-value="5">5</button>
                    </div>
                </div>
                <button id="close-queue-modal-btn" class="close-btn">Done</button>
            </div>
        </div>

        <!-- Repository Selector Modal -->
        <div id="repo-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content glass-card">
                <h2 class="modal-title">Select Repository</h2>
                <div class="skill-list">
                    <button class="skill-option repo-option" data-repo="FailSafe-Qore">
                        <span class="skill-name">FailSafe-Qore</span>
                        <span class="skill-desc">Primary Production</span>
                    </button>
                    <button class="skill-option repo-option" data-repo="MythologIQ Global">
                        <span class="skill-name">MythologIQ Global</span>
                        <span class="skill-desc">Core Infrastructure</span>
                    </button>
                    <button class="skill-option repo-option" data-repo="Zo-Shell Extensions">
                        <span class="skill-name">Zo-Shell Extensions</span>
                        <span class="skill-desc">UI Modules</span>
                    </button>
                </div>
                <button id="close-repo-modal-btn" class="close-btn" style="margin-top:10px;">Cancel</button>
            </div>
        </div>

        <!-- Skill Selector Modal -->
        <div id="skill-modal" class="modal-overlay" style="display:none;">
            <div class="modal-content glass-card">
                <h2 class="modal-title">Select Skill</h2>
                <div class="skill-list">
                    <button class="skill-option" data-cmd="/run-audit">
                        <span class="skill-name">System Audit</span>
                        <span class="skill-desc">Full security scan</span>
                    </button>
                    <button class="skill-option" data-cmd="/deploy-hotfix">
                        <span class="skill-name">Deploy Hotfix</span>
                        <span class="skill-desc">Push urgent patch</span>
                    </button>
                     <button class="skill-option" data-cmd="/reset-env">
                        <span class="skill-name">Reset Environment</span>
                        <span class="skill-desc">Clear cache & restart</span>
                    </button>
                     <button class="skill-option" data-cmd="/check-health">
                        <span class="skill-name">Health Check</span>
                        <span class="skill-desc">Verify all services</span>
                    </button>
                </div>
                <button id="close-skill-modal-btn" class="close-btn" style="margin-top:10px;">Cancel</button>
            </div>
        </div>

    </div>

    <script src="mobile.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-content');
            const navItems = document.querySelectorAll('.nav-item');
            const headerTabName = document.getElementById('header-tab-name');
            const queueItems = document.querySelectorAll('.queue-item');

            window.switchTab = function(targetId, label) {
                tabs.forEach(tab => {
                    tab.style.display = '';
                    tab.classList.remove('active');
                });
                
                const targetTab = document.getElementById(targetId);
                if (targetTab) {
                    void targetTab.offsetWidth;
                    targetTab.classList.add('active');
                }

                navItems.forEach(item => {
                    if (item.dataset.target === targetId) {
                        item.classList.add('active');
                        item.querySelector('.icon svg').style.stroke = 'var(--accent-cyan)';
                    } else {
                        item.classList.remove('active');
                        item.querySelector('.icon svg').style.stroke = 'currentColor';
                    }
                });
                
                // Update Header Label
                if(label) {
                    headerTabName.textContent = label;
                }
                
                // Save state to local storage for persistence on refresh
                localStorage.setItem('zoqore-active-tab', targetId);
                localStorage.setItem('zoqore-tab-label', label || 'Projects');
            }

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const btn = e.target.closest('.nav-item');
                    const targetId = btn.dataset.target;
                    const label = btn.dataset.label;
                    switchTab(targetId, label);
                });
            });

            // Settings Modal Logic (Main)
            const modal = document.getElementById('settings-modal');
            const openBtn = document.getElementById('app-logo-btn');
            const closeBtn = document.getElementById('close-modal-btn');
            // Theme buttons are global

            function openMainSettings() {
                modal.style.display = 'flex';
            }

            if(openBtn) openBtn.addEventListener('click', openMainSettings);
            if(closeBtn) closeBtn.addEventListener('click', () => modal.style.display = 'none');

            // Queue Settings Modal Logic
            const queueModal = document.getElementById('queue-modal');
            const queueSettingsBtn = document.getElementById('queue-settings-btn');
            const closeQueueBtn = document.getElementById('close-queue-modal-btn');
            const queueBtns = document.querySelectorAll('.queue-btn');
            // queueItems ref is global

             if(queueSettingsBtn) {
                queueSettingsBtn.addEventListener('click', () => {
                    queueModal.style.display = 'flex';
                });
            }

            if(closeQueueBtn) {
                closeQueueBtn.addEventListener('click', () => {
                    queueModal.style.display = 'none';
                });
            }

            // Repository Modal Logic
            const repoModal = document.getElementById('repo-modal');
            const repoBtn = document.getElementById('repo-selector-btn');
            const closeRepoBtn = document.getElementById('close-repo-modal-btn');
            const repoOptions = document.querySelectorAll('.repo-option');
            const currentRepoName = document.getElementById('current-repo-name');

            if(repoBtn) {
                repoBtn.addEventListener('click', () => {
                    repoModal.style.display = 'flex';
                });
            }
            if(closeRepoBtn) {
                closeRepoBtn.addEventListener('click', () => {
                    repoModal.style.display = 'none';
                });
            }
            
            repoOptions.forEach(opt => {
                opt.addEventListener('click', () => {
                   const repo = opt.dataset.repo;
                   if(currentRepoName) currentRepoName.textContent = repo.length > 20 ? repo.substring(0, 18) + '...' : repo;
                   repoModal.style.display = 'none';
                });
            });

            // Skill Modal Logic
            const skillModal = document.getElementById('skill-modal');
            const skillBtn = document.getElementById('skill-selector-btn');
            const closeSkillBtn = document.getElementById('close-skill-modal-btn');
            const cmdInput = document.getElementById('cmd-input');
            const skillOptions = document.querySelectorAll('.skill-option');

            if(skillBtn) {
                skillBtn.addEventListener('click', () => {
                    skillModal.style.display = 'flex';
                });
            }

            if(closeSkillBtn) {
                closeSkillBtn.addEventListener('click', () => {
                    skillModal.style.display = 'none';
                });
            }

            skillOptions.forEach(opt => {
                opt.addEventListener('click', () => {
                    const cmd = opt.dataset.cmd;
                    if(cmdInput) {
                        cmdInput.value = cmd;
                        cmdInput.focus();
                    }
                    skillModal.style.display = 'none';
                });
            });

            // Fullscreen Logic
            const fsBtn = document.getElementById('fullscreen-btn');
            
            function toggleFullScreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().then(() => {
                        if (screen.orientation && screen.orientation.lock) {
                            screen.orientation.lock('portrait').catch(e => {});
                        }
                    }).catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }

            if(fsBtn) fsBtn.addEventListener('click', toggleFullScreen);

            // "Auto" Fullscreen on first interaction (Browser Policy workaround)
            function autoFsOneShot() {
                toggleFullScreen();
                document.removeEventListener('click', autoFsOneShot);
                document.removeEventListener('touchstart', autoFsOneShot);
            }
            // Enable "Click anywhere to Start" style fullscreen
            document.addEventListener('click', autoFsOneShot);
            document.addEventListener('touchstart', autoFsOneShot);

            // Theme Management
            const themeBtns = document.querySelectorAll('.theme-card');
            
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('zoqore-theme', theme);
                
                // Update buttons
                themeBtns.forEach(b => {
                    if(b.dataset.theme === theme) b.classList.add('active');
                    else b.classList.remove('active');
                });
                
                // Handle Atmosphere Dynamic Logic
                if(theme === 'atmosphere') {
                   updateAtmosphere();
                }
            }

            function updateAtmosphere() {
                // Simple Day/Night simulation based on hours
                const hr = new Date().getHours();
                const isDay = hr > 6 && hr < 18;
                // We physically manipulate the CSS vars for the 'atmosphere' theme block if needed, 
                // but simpler is to toggles classes or just rely on the 'atmosphere' theme definitions 
                // which we will assume default to a "Local Weather" look.
                // For a true dynamic effect, we'd inject styles here. 
                // Let's just assume the CSS handles a static fancy gradient for now.
            }

            themeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const theme = btn.dataset.theme;
                    setTheme(theme);
                });
            });

            // Queue Depth Management
            function setQueueDepth(count) {
                const limit = parseInt(count);
                localStorage.setItem('zoqore-queue-depth', limit);
                
                // Update buttons
                queueBtns.forEach(b => {
                    if(parseInt(b.dataset.value) === limit) b.classList.add('active');
                    else b.classList.remove('active');
                });

                // Update visibility
                queueItems.forEach((item, index) => {
                    if(index < limit) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            queueBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    setQueueDepth(btn.dataset.value);
                });
            });

            // Restore Store
            const savedTheme = localStorage.getItem('zoqore-theme') || 'mythiq';
            setTheme(savedTheme);

            const savedQueueDepth = localStorage.getItem('zoqore-queue-depth') || 3;
            setQueueDepth(savedQueueDepth);

            const savedTab = localStorage.getItem('zoqore-active-tab') || 'tab-strategy';
            const savedLabel = localStorage.getItem('zoqore-tab-label') || 'Projects';
            switchTab(savedTab, savedLabel);
        });
    </script>
</body>
</html>
